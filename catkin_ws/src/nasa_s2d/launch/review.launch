<?xml version="1.0" encoding="UTF-8"?>
<launch>

    <arg name="bagroot"         default="$(eval env('HOME') + '/Documents/bags/nasa/')" />
    <arg name="bagname"         default="run3.bag" />
    <arg name="bagpath"         default="$(arg bagroot)/$(arg bagname)" />
    <arg name="hide_bag"        default="false" />
    <arg name="show_dashboard"  default="true" />
    <arg name="tuning"          default="true" />
    <arg name="ns"              default="review" />

    <!-- ###################################################################### -->

    <!-- launch-prefix settings for xterm, with ability to be hidden -->
    <arg if="$(arg hide_bag)"     name="prefix" value="" />
    <arg unless="$(arg hide_bag)" name="prefix" value="xterm -hold -geometry 100x20 -e" />

    <!-- The video in the rosbag is compressed - this decompresses it for visual_mtt -->
    <node pkg="image_transport" type="republish" name="decompress" output="log" args="compressed in:=camera/image_raw out:=$(arg ns)/camera/image_raw" />

    <!-- Play the selected rosbag. Also, remap the camera_info topic into the review namespace -->
    <node pkg="rosbag" type="play" name="player" args="-l $(arg bagpath) --clock" launch-prefix="$(arg prefix)">
      <remap from="camera/camera_info" to="$(arg ns)/camera/camera_info" />
    </node>

    <!-- launch visual_mtt in a namespace to avoid collision with recorded topics -->
    <group ns="$(arg ns)">
        <include file="$(find visual_mtt)/launch/visual_mtt.launch">
          <arg name="params"    value="$(find nasa_s2d)/param/sully.yaml" />
          <arg name="tuning"    value="$(arg tuning)" />
          <arg name="imgtopic"  value="camera/image_raw" />
        </include>

        <!-- Start up a dashboard perspective -->
        <group if="$(arg show_dashboard)">
            <node pkg="rqt_gui" type="rqt_gui" name="review_dashboard" args="--perspective-file '$(find nasa_s2d)/rqt/review.perspective'" />
        </group>
    </group>

</launch>
